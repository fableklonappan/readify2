{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
  .custom-h1 {
    margin-top: 10px;
    margin-bottom: 10px;
    margin-right: 250px;
    margin-left: 30px;
    color: black;
  }

  .image-container {
    width: fit-content;
    height: fit-content;
  }

  .image-container img {
    width: 150px;
    height: 280px;
  }

  /* CSS for the search container */
  .search-container {
    background-color: #ca3737;
    /* Background color */
    margin-top: 60px;
    padding: 20px;
    border-radius: 5px;
    /* Rounded corners */
    box-shadow: 0px 0px 10px rgba(10, 116, 49, 0.1);
    /* Box shadow for depth */
  }

  /* CSS for the search input */
  .search-input {
    margin-top: 9px;
    width: 500px;
    /* Take up the entire width of the container */
    padding: 10px;
    border: none;
    /* Remove border */
    border-radius: 50px;
    /* Rounded corners for the input */
    font-size: 18px;
    /* Font size */
  }

  /* Style for search results (customize as needed) */
  #search-results {
    margin-top: 20px;
    /* Add margin to separate from search bar */
    /* Add additional styling for search results here */
  }

  .search-container {
    position: relative;
  }

  .bi-search {
    position: absolute;
    right: 550px;
    /* Adjust this value to control the icon's position */
    top: 55%;
    transform: translateY(-50%);
  }
</style>

<body>
  <!-- Search Bar -->
  <div class="search-container d-flex">
    <h1 class="text custom-h1">Audio books</h1>
    <input type="text justify-content-center " id="search-input" class="search-input"
      placeholder="Search book name..." /><i class="bi bi-search text-danger"></i>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script>
    function showMoreCategories() {
      // Show hidden categories
      $("#categoryTabs li.d-none").removeClass("d-none");
      // Hide the "More" button
      $("#moreButton").addClass("d-none");
    }
  </script>

  <div class="container mt-3">
    <div id="search-results">
      <!-- Search results will be dynamically inserted here -->
    </div>
  </div>

  <!-- End Search Bar -->

  <!-- End Search Bar -->

  <div class="row toggle">
    <div class="container mt-3 mb-4">
      {% for i in audiobook %}
      <div class="row">
        <div class="col-md-12 mt-2">
          <div class="card d-flex flex-row">
            <div class="p-3 image-container">
              <img src="{{ i.cover_image.url }}" class="card-img-top pt-4" alt="Book Cover" />
            </div>
            <div class="card-body d-flex flex-row align-items-center">
              <div class="left">
                <h3 class="card-title">{{ i.title }}</h3>
                <p class="card-text">
                  <strong>Author:</strong>{{ i.author }}
                </p>
                <p class="card-text">
                  <strong>Duration:</strong>{{ i.duration }} minutes
                </p>
                <p class="card-text">
                  <strong>Narrator:</strong>{{ i.narrator }}
                </p>
                <p class="card-text">
                  <strong>Publication Date:</strong>{{ i.publication_date }}
                </p>
              </div>
              <div class="right d-flex flex-column w-75 ml-5">
                <a href="{{ i.audio_file.url }}" download class="btn btn-outline-info btn-lg"><i
                    class="bi bi-file-music-fill ml-5"></i> Download
                  Audiobook</a>
                <a href="{% url 'add_audiotolibrary' i.id %}" class="btn btn-outline-success mt-3 btn-lg"><i class="bi bi-folder-plus"></i> Add to Library</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>


  <script type="text/javascript">
    $(document).ready(function () {
      $("#search-input").on("keyup", function () {
        var query = $(this).val();

        $.ajax({
          type: "GET",
          url: "{% url 'live_search_audio' %}", // Update with your Django view URL
          data: {
            query: query,
          },
          success: function (data) {
            // Clear previous search results
            $("#search-results").empty();

            // Loop through the book data and create HTML elements
            for (var i = 0; i < data.bookdata.length; i++) {
              var book = data.bookdata[i];
              console.log(book);
              var bookHtml = `
                <div class="row ">
                    <div class="container mt-4 mb-4">
                        <div class="row">
                            <div class="col-md-12 mt-2">
                                <div class="card d-flex flex-row">
                                    <div class="p-3 image-container">
                                        <img src="${book.cover_image}" class="card-img-top pt-3" alt="Book Cover" />
                                    </div>
                                        <div class="card-body d-flex flex-row align-items-center">
                                            <div class="left">
                                                <h3 class="card-title">${book.title}</h3>
                                                <p class="card-text"><strong>Author:</strong>${book.author}</p>
                                                <p class="card-text"><strong>Duration:</strong>${book.duration} minutes</p>
                                                <p class="card-text"><strong>Narrator:</strong>${book.narrator}</p>
                                                <p class="card-text"><strong>Publication Date:</strong>${book.publication_date}</p>
                                            </div>
                                            <div class="right d-flex flex-column w-75 ml-5">
                                                <a href="${book.audio_file}" download class="btn btn-outline-info btn-lg w-100"><i class="bi bi-file-music-fill ml-5"></i> Download Audiobook</a>
                                                <a href="{% url 'add_audiotolibrary' 55 %}" class="btn btn-outline-success mt-3 btn-lg"><i class="bi bi-bookmarks"></i> Go to favorites</a>
                                            </div>
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>                

                      `.replace("55", book.id);
              $("#search-results").append(bookHtml);
              $(".toggle").hide();
            }
          },
        });
      });
    });
  </script>

{% endblock content %}
</body>

</html>