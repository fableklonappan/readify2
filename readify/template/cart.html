{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
    .image-container {
        width: fit-content;
        height: fit-content;
    }

    .image-container img {
        width: 100px;
        height: 130px;
    }

    .summary-container {
        height: 300px;
    }

    .tfooter {
        border-top: 2px dotted black;
    }

    #inputbox {
        width: 52px;
    }

    .plusBtn,
    .minusBtn {
        width: 30px;
        border-radius: 100%;
        font-weight: bold;
        height: 30px;
    }

    .custom-h1 {
        margin-top: 100px;
        margin-left: 90px;
        color: black;
    }

    .custom-margin {
        margin-top: 100px;
        margin-left: 90px;
        color: black;
    }
</style>




<body>
    <h1 class="text custom-h1">Shopping Cart</h1>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Check if there are messages and display them using SweetAlert -->
    {% if messages %}
    <script>
        {% for message in messages %}
        Swal.fire({
            icon: '{{ message.tags }}',
            title: '{{ message.tags }}',
            text: '{{ message }}',
            timer: 3000, // Auto close after 3 seconds
            showConfirmButton: false
        });
        {% endfor %}
    </script>
    {% endif %}
    <div class="container mt-5">
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th scope="col">Product Name</th>
                        <th scope="col">Unit Price</th>
                        <th scope="col">QUANTITY</th>
                        <th scope="col">TOTAL</th>
                        <th scope="col">Remove</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in cart_books %}
                    <tr>
                        <td>
                            <div class="media">
                                <img src="{{i.picture.url}}" alt="Product Image" class="mr-3" style="width: 72px;">
                                <div class="media-body mt-4">
                                    <h5>
                                        {{i.title}}
                                    </h5>
                                </div>
                            </div>
                        </td>
                        <td class="pt-5">₹ {{i.price}}</td>
                        <td class="">
                            {% for data in cartdata %}
                            {% if data.book_id == i.pk %}
                            <div
                                class="d-flex flex-row justify-content-center align-items-center mt-lg-5 mt-sm-2 mt-md-5">
                                <a type="button" class="btn btn-secondary p-0 text-decoration-none border minusBtn mr-3"
                                    href="{% url 'decrease_item' data.id %}">-</a>

                                <a class="text-decoration-none quantityValue" href="#"
                                    class="border">{{data.quantity}}</a>
                                <a type="button" class="btn btn-secondary  p-0 text-decoration-none border plusBtn ml-3"
                                    href="{% url 'increase_item' data.id %}">+</a>

                            </div>
                        </td>
                        <td class="item-total">₹ {{data.stock_total}}</td>
                        {% endif %}
                        {% endfor %}
                        <td class="text-center">
                            <a href="{% url 'delete_cart' i.id %}" class="text-danger"
                                onclick=" return confirmDelete();">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}

                    <!-- Repeat this row structure for each wishlist item -->
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-md-6 col-md-6 summary-container card mt-2 ml-5 mb-5">
        <div class="card-body">
            <h5 class="card-title">Shopping Cart Summary</h5>
            <hr>
            <table class="w-100">
                <thead>
                    <th>Item</th>
                    <th>Price</th>
                </thead>
                <tbody id="summary-list">

                    <!-- Add the following code for each product you want to include in the summary -->
                    <tr>
                        {% for i in cart_books %}
                        <td>{{i.title}}</td>
                        {% for data in cartdata %}
                        {% if data.book_id == i.pk %}
                        <td class="item-total1">₹ {{data.stock_total}}</td>
                        {% endif %}
                        {% endfor %}
                    </tr>
                    {% endfor %}
                    <!-- Repeat this block for each product -->
                    <!-- Calculate and display the total price -->
                    <tr>
                        <td><b>Total</b></td>
                        <td><b id="total-price">₹

                            </b></td>
                    </tr>
                    <!-- End of total price calculation -->


                </tbody>
            </table>

            <div class="d-flex justify-content-end w-100 flex-column">
                <div class="item-1">
                </div>
                <div class="item-2">
                    <button id="payment" class="btn btn-success mt-4 w-100 "><i
                            class="bi bi-credit-card pr-3"></i>Checkout</button>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- JavaScript to calculate total price when the window is loaded -->
    <script>

        function confirmDelete() {
            return confirm("Are you sure you want to delete this item?");
        }
        window.onload = function () {
            const totalPriceElement = document.getElementById('total-price');
            const itemTotalElements = document.querySelectorAll('.item-total');
            let totalPrice = 0;

            itemTotalElements.forEach((itemTotal) => {
                const itemPrice = parseFloat(itemTotal.textContent.replace('₹', ''));
                totalPrice += itemPrice;
            });

            totalPriceElement.textContent = `₹ ${totalPrice.toFixed(2)}`;
        };
    </script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            const totalPriceElement = document.getElementById('total-price');
            const itemTotalElements = document.querySelectorAll('.item-total');
            let totalPrice = 0;

            itemTotalElements.forEach((itemTotal) => {
                const itemPrice = parseFloat(itemTotal.textContent.replace('₹', ''));
                totalPrice += itemPrice;
            });
            $("#payment").on("click", function () {
                var query = $(this).val();
                window.location.href = "{% url 'payment' 0 %}".replace("0", parseInt(totalPrice));



            });
        });
    </script>

    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> -->

    {% endblock content %}
</body>

</html>